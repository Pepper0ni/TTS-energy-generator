energyTable={
 {set="Base",
  api=true,
  code="base1",
  types={
   ["Grass"]={num="99"},
   ["Fire"]={num="98"},
   ["Water"]={num="102"},
   ["Lightning"]={num="100"},
   ["Psychic"]={num="101"},
   ["Fighting"]={num="97"},
  },
  date="19990109"
 },
 {set="Expedition Base Set",
  api=true,
  code="ecard1",
  types={
   ["Grass"]={num="162"},
   ["Fire"]={num="161"},
   ["Water"]={num="165"},
   ["Lightning"]={num="163"},
   ["Psychic"]={num="164"},
   ["Fighting"]={num="160"},
  },
  date="20020915"
 },
 {set="Ruby & Sapphire",
  api=true,
  code="ex1",
  types={
   ["Grass"]={num="104"},
   ["Fire"]={num="108"},
   ["Water"]={num="106"},
   ["Lightning"]={num="109"},
   ["Psychic"]={num="107"},
   ["Fighting"]={num="105"},
  },
  date="20030701"
 },
 {set="Emerald",
  api=true,
  code="ex9",
  types={
   ["Grass"]={num="101"},
   ["Fire"]={num="102"},
   ["Water"]={num="103"},
   ["Lightning"]={num="104"},
   ["Psychic"]={num="105"},
   ["Fighting"]={num="106"}
  },
  date="20050501"
 },
 {set="Holon Phantoms",
  api=true,
  code="ex13",
  types={
   ["Grass"]={num="105"},
   ["Fire"]={num="106"},
   ["Water"]={num="107"},
   ["Lightning"]={num="108"},
   ["Psychic"]={num="109"},
   ["Fighting"]={num="110"}
  },
  date="20060501"
 },
 {set="Power Keepers",
  api=true,
  code="ex16",
  types={
   ["Grass"]={num="103"},
   ["Fire"]={num="104"},
   ["Water"]={num="105"},
   ["Lightning"]={num="106"},
   ["Psychic"]={num="107"},
   ["Fighting"]={num="108"}
  },
  date="20070202"
 },
 {set="Diamond & Pearl",
  api=true,
  code="dp1",
  types={
   ["Grass"]={num="123"},
   ["Fire"]={num="124"},
   ["Water"]={num="125"},
   ["Lightning"]={num="126"},
   ["Psychic"]={num="127"},
   ["Fighting"]={num="128"},
   ["Darkness"]={num="129"},
   ["Metal"]={num="130"}
  },
  date="20070501"
 },
 {set="Movie Commemoration Random Pack",
  types={
   ["Grass"]={steamUrl="1832405798625465500/D3730F4B293AB62AB619693A2CB66F775773DC7C/",num="E1"},
   ["Fire"]={steamUrl="1832405798625455940/509F5D4C4FC7777ACD7C262255FD40E8AAD5462D/",num="E2"},
   ["Water"]={steamUrl="1832405798625485038/0A15524996F5202AE08493ED09AE0AC47B6A5CD8/",num="E3"},
   ["Lightning"]={steamUrl="1832405798625494298/F8DFA471580360CB70787FA0889BD65D7240FD69/",num="E4"},
   ["Psychic"]={steamUrl="1832405798625513601/B00633C1C3D9963186F18792FD692591D2743132/",num="E5"},
   ["Fighting"]={steamUrl="1832405798625522357/12D4FAB3EDA2E47C3A56A5F2A5D90FA54173E2DD/",num="E6"},
   ["Darkness"]={steamUrl="1832405798625455574/3CAEED33508C134DFBF7DE1EBEAC9E00B534A639/",num="E7"},
   ["Metal"]={steamUrl="1832405798625531534/F2EEA63644E26D0EDA05D8BA1ECF15952ADBF36D/",num="E8"}
  },
  date="20090718"
 },
 {set="HeartGold & SoulSilver",
  api=true,
  code="hgss1",
  types={
   ["Grass"]={num="115"},
   ["Fire"]={num="116"},
   ["Water"]={num="117"},
   ["Lightning"]={num="118"},
   ["Psychic"]={num="119"},
   ["Fighting"]={num="120"},
   ["Darkness"]={num="121"},
   ["Metal"]={num="122"}
  },
  date="20100210"
 },
 {set="Black & White",
  api=true,
  code="bw1",
  types={
   ["Grass"]={num="105"},
   ["Fire"]={num="106"},
   ["Water"]={num="107"},
   ["Lightning"]={num="108"},
   ["Psychic"]={num="109"},
   ["Fighting"]={num="110"},
   ["Darkness"]={num="111"},
   ["Metal"]={num="112"}
  },
  date="20110425"
 },
 {set="XY",
  api=true,
  code="xy1",
  types={
   ["Grass"]={num="132"},
   ["Fire"]={num="133"},
   ["Water"]={num="134"},
   ["Lightning"]={num="135"},
   ["Psychic"]={num="136"},
   ["Fighting"]={num="137"},
   ["Darkness"]={num="138"},
   ["Metal"]={num="139"},
   ["Fairy"]={num="140"}
  },
  date="20140205"
 },
 {set="Generations",
  api=true,
  code="g1",
  types={
   ["Grass"]={num="75"},
   ["Fire"]={num="76"},
   ["Water"]={num="77"},
   ["Lightning"]={num="78"},
   ["Psychic"]={num="79"},
   ["Fighting"]={num="80"},
   ["Darkness"]={num="81"},
   ["Metal"]={num="82"},
   ["Fairy"]={num="83"}
  },
  date="20160222"
 },
 {set="Premium Champion Pack",
  types={
   ["Grass"]={steamUrl="1826780185929566902/E45311C6220C493CA3C4EB2AF5C0159DAC30505A/",num="E1"},
   ["Fire"]={steamUrl="1826780185929565257/0A45F2A992524F7CF3B06F5844B91D369C886BB5/",num="E2"},
   ["Water"]={steamUrl="1826780185929557394/B53B3B212AC022D2F63321B506B48C01BC48356D/",num="E3"},
   ["Lightning"]={steamUrl="1826780185929658153/64A245A57616D852ABD5F8642E51E26360FEA6F9/",num="E4"},
   ["Psychic"]={steamUrl="1826780185929566466/EEE00F8A2965ABA69787FE4EF45F3E3C7226DF0E/",num="E5"},
   ["Fighting"]={steamUrl="1826780185929565784/13E554629E5EF15FB7CA2FADD41238B6F5F8D8A7/",num="E6"},
   ["Darkness"]={steamUrl="1826780185929566147/8D2FC67A2409D375AEC24FA7F80EB1E935885FA5/",num="E7"},
   ["Metal"]={steamUrl="1826780185929556601/A7ECCDAF131757924EE05C9DB8454713CC7E5708/",num="E8"},
   ["Fairy"]={steamUrl="1826780185929565521/51D0C1018AE46B2C3A95BDEA5C2E811FD7A78322/",num="E8"}
  },
  date="20160416"
 },
 {set="Evolutions",
  api=true,
  code="xy12",
  types={
   ["Grass"]={num="91"},
   ["Fire"]={num="92"},
   ["Water"]={num="93"},
   ["Lightning"]={num="94"},
   ["Psychic"]={num="95"},
   ["Fighting"]={num="96"},
   ["Darkness"]={num="97"},
   ["Metal"]={num="98"},
   ["Fairy"]={num="99"}
  },
  date="20161102"
 },
 {set="Sun & Moon",
  types={
   ["Grass"]={steamUrl="1826780185929832402/5FE64CA2668E4A91ED64DD05E59D74CF958EADEB/",num="E1"},
   ["Fire"]={steamUrl="1826780185929832714/8853045CD1F634E848895927164FB5A522E39CEC/",num="E2"},
   ["Water"]={steamUrl="1826780185929832999/7B1E59BB866F9CBD81888416808101B3519CB8C9/",num="E3"},
   ["Lightning"]={steamUrl="1826780185929833512/90A9B8E6DA4C2F28FB267D97D7213D465DBF3186/",num="E4"},
   ["Psychic"]={steamUrl="1826780185929833839/B5C3FFB69E5180AEF58AABC6B648419A973AD1E5/",num="E5"},
   ["Fighting"]={steamUrl="1826780185929834195/8BB262C2D63EA80E6C04F09136CCD043D75EC2BE/",num="E6"},
   ["Darkness"]={steamUrl="1826780185929834635/F274B54CA2718B0CDADEA30355C2CA435E8A4E1A/",num="E7"},
   ["Metal"]={steamUrl="1826780185929834975/1892F7B06D18C0B1AB7F4FFEC69FF52239D21B5F/",num="E8"},
   ["Fairy"]={steamUrl="1826780185929835278/E2A48B5AD439570D5613491267C9B649055ACA4F/",num="E8"}
  },
  date="20170203"
 },
 {set="Gen 7 Secret",
  api=true,
  types={
   ["Grass"]={code="sm2",setName="Guardians Rising",date="20170505",num="167"},
   ["Fire"]={code="sm3",setName="Burning Shadows",date="20170805",num="167"},
   ["Water"]={code="sm4",setName="Crimson Invasion",date="20171103",num="124"},
   ["Lightning"]={code="sm2",setName="Guardians Rising",date="20170505",num="168"},
   ["Psychic"]={code="sm1",setName="Sun & Moon",date="20170203",num="162"},
   ["Fighting"]={code="sm2",setName="Guardians Rising",date="20170505",num="169"},
   ["Darkness"]={code="sm3",setName="Burning Shadows",date="20170805",num="168"},
   ["Metal"]={code="sm1",setName="Sun & Moon",date="20170203",num="163"},
   ["Fairy"]={code="sm3",setName="Burning Shadows",date="20170805",num="169"}
  }
 },
 {set="Team Up",
  types={
   ["Grass"]={steamUrl="1832405798628986164/8DAE81347A07897ACD085586A20D95CF2598E347/",num="E1"},
   ["Fire"]={steamUrl="1832405798628987149/3187D01AA63593BAD2A13058C9A64986771B83D5/",num="E2"},
   ["Water"]={steamUrl="1832405798628988741/04A35BDD099EBE7E18DBB9D7E7AB999D5BA66D9E/",num="E3"},
   ["Lightning"]={steamUrl="1832405798628989261/5967BCC4EB91584ABEB1680F1CF83B70302EAF52/",num="E4"},
   ["Psychic"]={steamUrl="1832405798628989709/D12DB2BE41A2185C11D87062EC08E285969F82A5/",num="E5"},
   ["Fighting"]={steamUrl="1832405798628991233/69EB109A4FE5D47D1B58FB59EC2517A30DB1DA20/",num="E6"},
   ["Darkness"]={steamUrl="1832405798628991928/8B177CCA848C1747B3790053958FAA79F3E0314B/",num="E7"},
   ["Metal"]={steamUrl="1832405798628992609/CC82A01EDC098ABEDA1376083E17D028F387A0A7/",num="E8"},
   ["Fairy"]={steamUrl="1832405798628993182/0CBE5BDF044B22B16510A8699F3B00CAC229C14C/",num="E9"}
  },
  date="20190201"
 },
 {set="Sword & Shield",
  types={
   ["Grass"]={steamUrl="1832405798628838691/9F72772F0F21C4F6455D35CDDA7C0387D2C344CD/",num="E1"},
   ["Fire"]={steamUrl="1832405798628839998/882EB1317DC1D12FF4994221E57FE41B4ECF8D70/",num="E2"},
   ["Water"]={steamUrl="1832405798628840522/64FB79B3C680D7B11BAEFD367E03115243508AC2/",num="E3"},
   ["Lightning"]={steamUrl="1832405798628842568/67A8211D36AE2FF603C7A4B775C894EA25EA9155/",num="E4"},
   ["Psychic"]={steamUrl="1832405798628843075/407375AECC10AD4150F2C70FBB63A0BAC0A9AE05/",num="E5"},
   ["Fighting"]={steamUrl="1832405798628843991/B1DDC67C84E0E0E1527F85058DCDF038DB9D8663/",num="E6"},
   ["Darkness"]={steamUrl="1832405798628844608/70C62511CA9F2631D1E1DE691F4099A8102EE7EC/",num="E7"},
   ["Metal"]={steamUrl="1832405798628845093/EC66EEED31A9BAB8CCEDBB7152B0B4EC4C9D6F55/",num="E8"},
   ["Fairy"]={steamUrl="1832405798628845735/B64816866B1D0B67963CE2E9114F77A2E9C3BD2E/",num="E9"}
  },
  date="20200207"
 },
 {set="Gen 8 Secret",
  api=true,
  types={
   ["Grass"]={code="swsh8",setName="Fusion Strike",date="20211112",num="283"},
   ["Fire"]={code="swsh8",setName="Fusion Strike",date="20211112",num="284"},
   ["Water"]={code="swsh6",setName="Chilling Reign",date="20210618",num="231"},
   ["Lightning"]={code="swsh7",setName="Evolving Skies",date="20210827",num="235"},
   ["Psychic"]={code="swsh6",setName="Chilling Reign",date="20210618",num="232"},
   ["Fighting"]={code="swsh6",setName="Chilling Reign",date="20210618",num="233"},
   ["Darkness"]={code="swsh7",setName="Evolving Skies",date="20210827",num="236"},
   ["Metal"]={code="swsh7",setName="Evolving Skies",date="20210827",num="237"}
  }
 },
 {set="Brilliant Stars",
  types={
   ["Grass"]={steamUrl="1826780185929555880/372B5B066A086B8C2BE6BB12BFF22A06E670A7D4/",num="E1"},
   ["Fire"]={steamUrl="1826780185929553692/3C455F9E5B065CA3F187437CEF7C0C1DC18D3364/",num="E2"},
   ["Water"]={steamUrl="1826780185929554213/1AC32F5486DADA025C75AF6C50826F5DD65C7310/",num="E3"},
   ["Lightning"]={steamUrl="1826780185929555089/70E625A480476310B1BE4D353E3D963A2677488C/",num="E4"},
   ["Psychic"]={steamUrl="1826780185929554817/CFD75E425D8617FF11F3880BEE539FEDE12950D8/",num="E5"},
   ["Fighting"]={steamUrl="1826780185929555505/B823653C20374BF18DF0447C5C0E4D4BABB16B97/",num="E6"},
   ["Darkness"]={steamUrl="1826780185929553931/AF97A4F5165E94AA167231105A337E131E2E487E/",num="E7"},
   ["Metal"]={steamUrl="1826780185929554488/1686C79E1368D62332155EC5545CBB716D5A1015/",num="E8"},
  },
  date="20220225"
 }
}

function onLoad(state)
 if state and state!=""then
  local save=json.parse(state)
  curSet=save.curSet
  curType=save.curType
 else
  curSet=11
  curType="Grass"
 end
 if self.GetCustomObject().diffuse!=getImageURL()then changeArt() return end
 DrawUI()
end

function DrawUI()
 local scale=self.getScale()
 local count=1
 makeButtonUI("<","prevSet",{-1.7,0,1.8},"Previous Set",scale,1)
 makeButtonUI(">","nextSet",{1.7,0,1.8},"Next Set",scale,1)
 local XMLTable={}

 for Type,data in pairs(energyTable[curSet].types) do
  _G["changeType"..Type]=function()changeType(Type)end
  local pos={}
  if count<=3 then
   pos={2-(1*count),0,-3}
  else
   pos={1.7+(-3.4*(count%2)),0,-1.8+(1.2*math.floor((count-4)/2))}
  end
  XMLTable[#XMLTable+1]=makeTypeUI(Type,scale,pos)
  count=count+1
 end
 self.UI.setXmlTable(XMLTable)
end

function makeTypeUI(Type,scale,pos)
 makeButtonUI("","changeType"..Type,{pos[1]*-1,pos[2],pos[3]},Type,scale,0)
 return {
  tag="Image",
  attributes={
   image=Type,
   height=100,
   width=100,
   position=tostring(pos[1]*100).." "..tostring(pos[3]*100).." 0",
   rotation="0 0 180",
   scale=tostring(1/scale.x*0.75).." "..tostring(1/scale.z*0.75).." 1",
   raycastTarget=false
  }}
end

function makeButtonUI(text,func,pos,tool,scale,transparency)
 local params={
 function_owner=self,
 label=text,
 tooltip=tool,
 font_size=380,
 width=350,
 height=350,
 position=pos,
 scale={1/scale[1],1/scale[2],1/scale[3]},
 click_function=func,
 color={1,1,1,transparency}
 }
 self.createButton(params)
end


function changeType(newType)
 curType=newType
 changeArt()
end

function prevSet()
 curSet=curSet-1
 if curSet==0 then curSet=#energyTable end
 changeArt()
end

function nextSet()
 curSet=curSet+1
 if curSet>#energyTable then curSet=1 end
 changeArt()
end

function onObjectLeaveContainer(cont,leaving)
 if cont~=self then return end
 local setTable=energyTable[curSet]
 leaving.setCustomObject({face=getImageURL(),back=getSteamUrl("809997459557414686/9ABD9158841F1167D295FD1295D7A597E03A7487/")})
 leaving.setName(curType.." Energy")
 leaving.setDescription((setTable.types[curType].setName or setTable.set).." #"..setTable.types[curType].num)
 leaving.memo=((setTable.types[curType].date or setTable.date)..setTable.types[curType].num)
end

function getImageURL()
 local setTable=energyTable[curSet]
 if setTable.api then
  return "https://images.pokemontcg.io/"..(setTable.code or setTable.types[curType].code).."/"..setTable.types[curType].num.."_hires.png?count="..setTable.types[curType].num
 else
  return getSteamUrl(setTable.types[curType].steamUrl)
 end
end

function getSteamUrl(url)
 return "http://cloud-3.steamusercontent.com/ugc/"..url
end

function changeArt()
 setTable=energyTable[curSet]
 if not setTable.types[curType] then
  curType="Grass"
 end
 saveData()
 self.setDescription(setTable.set.." "..curType.." Energy")
 self.setCustomObject({diffuse=getImageURL()})
 self.reload()
end

function saveData()
  local save={curType=curType,curSet=curSet}
  self.script_state=json.serialize(save)
end
